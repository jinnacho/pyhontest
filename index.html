<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>파이썬 프로그래밍 통합 실습 센터</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Fira+Code:wght@400;500&display=swap');
        
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; }
        .code-font { font-family: 'Fira Code', monospace; }
        .active-tab { border-bottom: 4px solid #3b82f6; color: #3b82f6; }
        .topic-card:hover { transform: translateY(-2px); transition: all 0.2s; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        /* 로딩 애니메이션 */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3498db;
            width: 18px;
            height: 18px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-slate-800">

    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <i class="fa-brands fa-python text-3xl text-blue-500"></i>
                    <span class="font-bold text-xl tracking-tight text-slate-900">Python Mastery Lab</span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <button onclick="switchTab('curriculum')" id="btn-curriculum" class="tab-btn py-5 px-1 font-medium active-tab">커리큘럼</button>
                    <button onclick="switchTab('practice')" id="btn-practice" class="tab-btn py-5 px-1 font-medium text-slate-500 hover:text-blue-500">코딩 실습</button>
                    <button onclick="switchTab('assignment')" id="btn-assignment" class="tab-btn py-5 px-1 font-medium text-slate-500 hover:text-blue-500">과제 제출</button>
                </div>
                <div class="text-sm font-medium text-blue-600 bg-blue-50 px-4 py-1.5 rounded-full border border-blue-100">
                    클라우드 연동 모드
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- SECTION 1: Curriculum & Theory -->
        <section id="tab-curriculum" class="tab-content space-y-8">
            <div class="bg-orange-50 border-l-4 border-orange-400 p-4 rounded-r-xl">
                <div class="flex">
                    <div class="flex-shrink-0"><i class="fa-solid fa-triangle-exclamation text-orange-400"></i></div>
                    <div class="ml-3">
                        <p class="text-sm text-orange-700 font-bold">실시간 저장 알림:</p>
                        <p class="text-sm text-orange-600">수정한 코드를 제출하면 선생님의 구글 스프레드시트에 자동으로 기록됩니다.</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 topic-card">
                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center mb-4">
                        <i class="fa-solid fa-calculator"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">변수, 자료형, 연산</h3>
                    <p class="text-sm text-slate-500">Casting 오류를 찾아 수정하세요.</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 topic-card">
                    <div class="w-10 h-10 bg-green-100 text-green-600 rounded-lg flex items-center justify-center mb-4">
                        <i class="fa-solid fa-table-cells"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">다차원 배열</h3>
                    <p class="text-sm text-slate-500">인덱스 접근법 미션입니다.</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 topic-card">
                    <div class="w-10 h-10 bg-red-100 text-red-600 rounded-lg flex items-center justify-center mb-4">
                        <i class="fa-solid fa-rotate"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">중첩 제어문</h3>
                    <p class="text-sm text-slate-500">반복문 빈칸을 채우세요.</p>
                </div>
            </div>
        </section>

        <!-- SECTION 2: Practice -->
        <section id="tab-practice" class="tab-content hidden space-y-6">
            <div class="flex flex-col lg:flex-row gap-6">
                <div class="w-full lg:w-1/4 space-y-4">
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                        <h4 class="font-bold text-slate-400 text-xs mb-4 uppercase">실습 예제</h4>
                        <div class="space-y-2">
                            <button onclick="loadExercise('vars')" class="w-full text-left px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-50">변수와 형 변환</button>
                            <button onclick="loadExercise('matrix')" class="w-full text-left px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-50">다차원 배열</button>
                            <button onclick="loadExercise('loop')" class="w-full text-left px-4 py-3 rounded-xl text-sm font-medium hover:bg-slate-50">중첩 반복문</button>
                        </div>
                    </div>
                </div>

                <div class="w-full lg:w-3/4 space-y-4">
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                        <div class="bg-slate-900 px-6 py-4 flex justify-between items-center">
                            <span id="current-filename" class="text-sm text-blue-400 code-font font-bold">practice.py</span>
                            <button onclick="runCodeSim()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-1.5 rounded-full text-sm font-bold">RUN CODE</button>
                        </div>
                        <div class="flex flex-col md:flex-row h-[450px]">
                            <div class="w-full md:w-1/2 p-0 overflow-auto bg-[#1e1e1e]">
                                <pre class="p-6 text-slate-300 code-font text-sm outline-none" id="code-editor" contenteditable="true" spellcheck="false"># 코드를 입력하세요</pre>
                            </div>
                            <div class="w-full md:w-1/2 bg-black p-6 text-green-400 code-font text-xs overflow-auto" id="output-screen">
> 코드를 실행하면 결과가 여기에 나타납니다.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Assignment -->
        <section id="tab-assignment" class="tab-content hidden">
            <div class="max-w-4xl mx-auto bg-white p-10 rounded-3xl shadow-sm border border-slate-100">
                <h2 class="text-2xl font-bold mb-6">최종 코드 제출 (Google 시트 연동)</h2>
                <form id="submission-form" class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="student-id" placeholder="학번 (예: 30101)" class="bg-slate-50 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="text" id="student-name" placeholder="이름" class="bg-slate-50 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <textarea id="submission-code" rows="10" class="w-full bg-slate-900 text-blue-300 rounded-xl p-4 code-font text-sm" placeholder="# 수정한 최종 코드를 붙여넣으세요..."></textarea>
                    
                    <button type="button" id="submit-btn" onclick="submitAssignment()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold hover:bg-slate-800 transition flex justify-center items-center">
                        <span id="btn-text">과제 제출하기</span>
                    </button>
                </form>
            </div>
        </section>

    </main>

    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-4 rounded-2xl shadow-2xl transform translate-y-32 transition-all duration-500 flex items-center gap-4 z-[100]">
        <div id="toast-icon-bg" class="w-8 h-8 rounded-full flex items-center justify-center">
            <i id="toast-icon" class="fa-solid fa-check"></i>
        </div>
        <div>
            <div id="toast-title" class="font-bold text-sm">알림</div>
            <div id="toast-message" class="text-xs text-slate-400">내용이 처리되었습니다.</div>
        </div>
    </div>

    <script>
        // 중요: 배포한 Google Apps Script 웹 앱 URL을 여기에 넣으세요!
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzGgXQ2dmkD22r0biuSQZa1sZ8wt1VBoOoYdaqdbgs6HmqlsKHcVhc1ujFqy2WxC1TO/exec';

        const exercises = {
            vars: { name: 'casting_error.py', code: 'num = input("숫자 입력: ")\n# 에러를 수정하세요\nprint(num + 10)' },
            matrix: { name: 'matrix_blank.py', code: 'data = [["서울", 10], ["부산", 20]]\nprint(data[____][0])' },
            loop: { name: 'loop_blank.py', code: 'for i in range(2, 4):\n    for j in range(1, 10)____\n        print(f"{i} x {j} = {____}")' }
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active-tab', 'text-blue-600'));
            document.getElementById('btn-' + tabId).classList.add('active-tab');
        }

        function loadExercise(key) {
            const ex = exercises[key];
            document.getElementById('current-filename').innerText = ex.name;
            document.getElementById('code-editor').innerText = ex.code;
            switchTab('practice');
        }

        function runCodeSim() {
            const output = document.getElementById('output-screen');
            const code = document.getElementById('code-editor').innerText;
            output.innerHTML = "> 분석 중...\n";
            setTimeout(() => {
                if(code.includes('____')) output.innerHTML += "오류: 빈칸이 있습니다.";
                else output.innerHTML += "실행 성공! 결과를 확인하고 제출 탭으로 이동하세요.";
            }, 500);
        }

        async function submitAssignment() {
            const studentId = document.getElementById('student-id').value;
            const name = document.getElementById('student-name').value;
            const code = document.getElementById('submission-code').value;
            const btn = document.getElementById('submit-btn');
            const btnText = document.getElementById('btn-text');

            if (!studentId || !name || !code) {
                showToast("모든 항목을 입력해 주세요.", "error");
                return;
            }

            if (scriptURL.includes('YOUR_GOOGLE_SCRIPT')) {
                showToast("선생님 설정: Script URL이 설정되지 않았습니다.", "error");
                return;
            }

            // 제출 대기 상태 표시
            btn.disabled = true;
            btnText.innerHTML = '<span class="loader"></span> 제출 중...';

            const payload = {
                studentId: studentId,
                name: name,
                code: code
            };

            try {
                // Google Apps Script는 CORS 이슈로 인해 fetch 시 no-cors 모드가 필요할 수 있으나, 
                // JSON 전송을 위해 아래 방식을 주로 사용합니다.
                await fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors', // Apps Script 리다이렉션 특성상 no-cors가 안정적입니다.
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                showToast("성공적으로 구글 시트에 저장되었습니다!", "success");
                document.getElementById('submission-form').reset();
            } catch (error) {
                console.error('Error!', error.message);
                showToast("제출 실패: 네트워크를 확인하세요.", "error");
            } finally {
                btn.disabled = false;
                btnText.innerHTML = '과제 최종 제출하기';
            }
        }

        function showToast(message, type) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').innerText = message;
            const bg = document.getElementById('toast-icon-bg');
            bg.className = type === 'success' ? "w-8 h-8 rounded-full flex items-center justify-center bg-green-500" : "w-8 h-8 rounded-full flex items-center justify-center bg-red-500";
            toast.classList.remove('translate-y-32');
            setTimeout(() => { toast.classList.add('translate-y-32'); }, 3000);
        }
    </script>
</body>
</html>
